# ===================================
# External Secrets (Alternative to Sealed Secrets)
# ===================================
# Use this if you have HashiCorp Vault, AWS Secrets Manager, etc.
#
# Prerequisites:
# 1. Install External Secrets Operator:
#    helm repo add external-secrets https://charts.external-secrets.io
#    helm install external-secrets external-secrets/external-secrets -n external-secrets --create-namespace
#
# 2. Create a SecretStore or ClusterSecretStore pointing to your backend

---
# Example: AWS Secrets Manager SecretStore
# apiVersion: external-secrets.io/v1beta1
# kind: SecretStore
# metadata:
#   name: aws-secrets-manager
#   namespace: realtime-poll
# spec:
#   provider:
#     aws:
#       service: SecretsManager
#       region: us-east-1
#       auth:
#         jwt:
#           serviceAccountRef:
#             name: external-secrets-sa

---
# Example: HashiCorp Vault SecretStore
# apiVersion: external-secrets.io/v1beta1
# kind: SecretStore
# metadata:
#   name: vault-backend
#   namespace: realtime-poll
# spec:
#   provider:
#     vault:
#       server: "https://vault.example.com"
#       path: "secret"
#       version: "v2"
#       auth:
#         kubernetes:
#           mountPath: "kubernetes"
#           role: "realtime-poll"
#           serviceAccountRef:
#             name: backend-sa

---
# ExternalSecret that fetches secrets from the backend
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: realtime-poll-secrets
  namespace: realtime-poll
  labels:
    app.kubernetes.io/name: realtime-poll
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: vault-backend  # or aws-secrets-manager
    kind: SecretStore
  target:
    name: realtime-poll-secrets
    creationPolicy: Owner
  data:
    - secretKey: REDIS_PASSWORD
      remoteRef:
        key: realtime-poll/redis
        property: password
    - secretKey: SESSION_SECRET
      remoteRef:
        key: realtime-poll/session
        property: secret
